<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NOURELECTRO</title>
  <meta name="description" content="NOURELECTRO â€” Ù…ØªØ¬Ø± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¨Ø³ÙŠØ· Ù…Ø¹ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨" />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64'%3E%3Ctext x='0' y='48' font-size='48'%3EğŸ›ï¸%3C/text%3E%3C/svg%3E">
  <style>
    :root{
      --bg:#f5f6f7;--card:#fff;--text:#222;--muted:#666;--brand:#0a84ff;--brand-dark:#086bd0;--danger:#e74c3c;
      --shadow:0 2px 8px rgba(0,0,0,.08)
    }
    *{box-sizing:border-box}html,body{margin:0;padding:0}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:var(--bg);color:var(--text);line-height:1.65}
    a{color:inherit;text-decoration:none}
    header,footer{background:#333;color:#fff}
    header{position:sticky;top:0;z-index:50;box-shadow:var(--shadow)}
    .wrap{max-width:1100px;margin:auto;padding:0 16px}
    .head{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:12px 0}
    .head h1{font-size:1.25rem;margin:0}
    nav a{margin:0 .5rem;opacity:.9}
    nav a:hover{opacity:1;color:var(--brand)}
    .toolbar{display:flex;gap:8px;align-items:center}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;border:0;border-radius:10px;padding:10px 14px;background:var(--brand);color:#fff;cursor:pointer;box-shadow:var(--shadow)}
    .btn:hover{background:var(--brand-dark)}
    .btn.ghost{background:transparent;border:1px solid #555;color:#fff}
    main{padding:18px 0}
    h2.section{font-size:1.4rem;margin:12px 0 18px}
    .grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(250px,1fr))}
    .card{background:var(--card);border-radius:14px;box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column}
    .imgbox{position:relative;background:#eee;aspect-ratio:4/3;overflow:hidden}
    .imgbox img{width:100%;height:100%;object-fit:cover;transition:transform .25s;cursor:zoom-in;touch-action:pan-y}
    .imgbox img:active{transform:scale(1.01)}
    .thumbs{display:flex;gap:6px;padding:8px;overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:thin}
    .thumbs::-webkit-scrollbar{height:6px}
    .thumbs::-webkit-scrollbar-thumb{background:rgba(0,0,0,.2);border-radius:3px}
    .thumbs img{width:58px;height:58px;border-radius:8px;object-fit:cover;cursor:pointer;border:2px solid transparent;flex:0 0 auto}
    .thumbs img.active{border-color:var(--brand)}
    .content{padding:12px 14px;display:flex;flex-direction:column;gap:8px;flex:1}
    .title{font-size:1.05rem;font-weight:700}
    .price{color:var(--brand);font-weight:800}
    .muted{color:var(--muted);font-size:.92rem}
    .card .actions{padding:12px 14px;display:flex;gap:8px}
    .floating-wa{position:fixed;left:16px;bottom:16px;background:#25D366;color:#fff;border-radius:999px;padding:12px 18px;box-shadow:var(--shadow);z-index:40}
    /* cart drawer */
    .drawer{position:fixed;inset:0;display:none}
    .drawer.open{display:block}
    .drawer .backdrop{position:absolute;inset:0;background:rgba(0,0,0,.4)}
    .drawer .panel{position:absolute;top:0;bottom:0;left:0;right:0;margin:auto;max-width:520px;width:100%;height:min(90vh,720px);background:#fff;border-radius:16px;overflow:auto;box-shadow:var(--shadow)}
    .drawer .panel header{background:#fff;color:var(--text);position:sticky;top:0;padding:12px 16px;border-bottom:1px solid #eee}
    .drawer .panel .body{padding:14px}
    .row{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px dashed #eee}
    .row:last-child{border:0}
    .qty{display:flex;gap:6px;align-items:center}
    .qty button{width:28px;height:28px;border-radius:8px;border:1px solid #ddd;background:#fafafa;cursor:pointer}
    .total{font-size:1.1rem;font-weight:800}
    form .field{display:flex;flex-direction:column;gap:6px;margin:10px 0}
    form input, form textarea{padding:10px 12px;border:1px solid #ddd;border-radius:10px;font-family:inherit}
    .alert{padding:10px 12px;border-radius:10px;background:#fff7e6;border:1px solid #ffe1a3;color:#8a5a00;margin:8px 0}
    /* image modal */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center;z-index:60}
    .modal.open{display:flex}
    .modal img{max-width:95vw;max-height:85vh;border-radius:10px}
    footer{margin-top:24px}
    footer .foot{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;padding:14px 0}
    @media (max-width:520px){.drawer .panel{max-width:none;border-radius:14px}}
  </style>
</head>
<body>

<header>
  <div class="wrap head">
    <h1>NOURELECTRO</h1>
    <!-- Ø¥Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ø³Ù„Ø© ÙÙ‚Ø· ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± -->
    <nav><a href="#" id="open-cart">Ø§Ù„Ø³Ù„Ø© ğŸ›’</a></nav>
  </div>
</header>

<main class="wrap">
  <h2 class="section">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
  <div id="product-list" class="grid" aria-live="polite"></div>
  <div id="status" class="muted" style="padding:12px 2px;"></div>

  <!-- Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù†ØµÙŠØ© ÙÙŠ Ø§Ù„ØªØ°ÙŠÙŠÙ„ ÙÙ‚Ø·ØŒ Ù„Ø°Ø§ Ù„Ø§ Ù†Ø¹Ø±Ø¶Ù‡Ø§ Ù‡Ù†Ø§ -->
</main>

<a class="floating-wa" id="wa-float" href="#" aria-label="ÙˆØ§ØªØ³Ø§Ø¨">ÙˆØ§ØªØ³Ø§Ø¨</a>

<footer>
  <div class="wrap foot">
    <nav>
      <a href="#about">Ù…Ù† Ù†Ø­Ù†</a> Â·
      <a href="#privacy">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a> Â·
      <a href="#terms">Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</a> Â·
      <a href="#faq">Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©</a>
    </nav>
    <small>Â© 2025 NOURELECTRO. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</small>
  </div>

  <!-- Ù†Øµ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø¯Ø§Ø®Ù„ Ø§Ù„ÙÙˆØªØ± (Ù„Ø§ Ø±ÙˆØ§Ø¨Ø· ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰) -->
  <div class="wrap" style="padding-bottom:16px">
    <section id="about"><h2 class="section">Ù…Ù† Ù†Ø­Ù†</h2><p class="muted">Ù†Øµ ØªØ¹Ø±ÙŠÙÙŠ Ù…Ø®ØªØµØ± Ø¹Ù† Ø§Ù„Ù…ØªØ¬Ø±.</p></section>
    <section id="faq"><h2 class="section">Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©</h2><p class="muted">Ø£Ø¶Ù Ø£ÙƒØ«Ø± Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ØªÙƒØ±Ø§Ø±Ø§Ù‹ ÙˆØ¥Ø¬Ø§Ø¨Ø§ØªÙ‡Ø§.</p></section>
    <section id="privacy"><h2 class="section">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</h2><p class="muted">ÙƒÙŠÙ Ù†ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡.</p></section>
    <section id="terms"><h2 class="section">Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</h2><p class="muted">Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹.</p></section>
  </div>
</footer>

<!-- Ø³Ù„Ø©/Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ -->
<div class="drawer" id="cart-drawer" role="dialog" aria-modal="true">
  <div class="backdrop" id="close-cart"></div>
  <div class="panel">
    <header class="wrap head" style="padding:10px 14px">
      <strong>Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</strong>
      <button class="btn ghost" id="close-cart-2">Ø¥ØºÙ„Ø§Ù‚</button>
    </header>
    <div class="body">
      <div id="cart-items"></div>
      <div class="row">
        <div class="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="cart-total">0</span> Ø¯.Ù…</div>
        <button class="btn" id="clear-cart">ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©</button>
      </div>
      <div class="alert">Ù„Ù† ØªØªÙ… Ø£ÙŠ Ø¯ÙØ¹Ø§Øª Ø¹Ø¨Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹. Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„ØªØ£ÙƒÙŠØ¯.</div>
      <form id="checkout-form">
        <div class="field"><label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label><input required name="name" placeholder="Ø§Ù„Ø§Ø³Ù… ÙƒÙ…Ø§ Ø³ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨"></div>
        <div class="field"><label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ù…Ø¹ Ø±Ù…Ø² Ø§Ù„Ø¯ÙˆÙ„Ø©)</label><input required name="phone" inputmode="tel" placeholder="Ù…Ø«Ø§Ù„: 2126xxxxxxxx"></div>
        <div class="field"><label>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label><input required name="city" placeholder="Ù…Ø¯ÙŠÙ†ØªÙƒ"></div>
        <button class="btn" type="submit">Ø¥ØªÙ…Ø§Ù… Ø§Ù„ØµÙÙ‚Ø© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>
      </form>
    </div>
  </div>
</div>

<!-- Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…ÙƒØ¨Ø±Ø© -->
<div class="modal" id="img-modal"><img alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬" id="modal-img"></div>

<script>
/* ====== Backendless ====== */
const APP_ID  = "14D39C00-FA0E-4E48-B415-8214C199398E";
const API_KEY = "E466FDD7-C03A-4492-A795-EC7539A87F74";
const TABLE   = "Products";
const API_URL = `https://api.backendless.com/${APP_ID}/${API_KEY}/data/${TABLE}?pageSize=100&sortBy=created%20desc`;

/* ====== DOM ====== */
const listEl   = document.getElementById('product-list');
const statusEl = document.getElementById('status');

/* ====== Placeholder Ù„Ù„ØµÙˆØ±Ø© ====== */
const FALLBACK_SRC = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='600' height='450'%3E%3Crect width='100%25' height='100%25' fill='%23e9ecef'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%2399a' font-size='22' font-family='system-ui'%3EØµÙˆØ±Ø©%20Ø§Ù„Ù…Ù†ØªØ¬%3C/text%3E%3C/svg%3E";

/* ====== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ====== */
async function loadProducts(){
  try{
    statusEl.textContent = "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...";
    const res = await fetch(API_URL);
    if(!res.ok) throw new Error("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Backendless");
    const items = await res.json();
    if(!Array.isArray(items) || items.length===0){
      statusEl.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.";
      return;
    }
    statusEl.textContent = "";
    renderProducts(items);
  }catch(err){
    console.error(err);
    statusEl.textContent = "ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† APP_ID Ùˆ API_KEY ÙˆØ§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„.";
  }
}

/* ====== Ø±Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ====== */
function renderProducts(products){
  listEl.innerHTML = "";
  products.forEach(p=>{
    const images = normalizeImages(p);
    const card = document.createElement('article');
    card.className = "card";

    // Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© + Ù…ØµØºØ±Ø§Øª
    const imgbox = document.createElement('div');
    imgbox.className = "imgbox";
    const mainImg = document.createElement('img');
    mainImg.src = images[0] || FALLBACK_SRC;
    mainImg.alt = p.name || "Ù…Ù†ØªØ¬";
    mainImg.loading = "lazy";
    mainImg.onerror = ()=> mainImg.src = FALLBACK_SRC;
    mainImg.addEventListener('click',()=>openImage(mainImg.src));
    enableSwipe(mainImg, images); // Ø³Ø­Ø¨ ÙŠÙ…ÙŠÙ†/ÙŠØ³Ø§Ø± Ù„Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    imgbox.appendChild(mainImg);
    card.appendChild(imgbox);

    if(images.length>1){
      const thumbs = document.createElement('div');
      thumbs.className = "thumbs";
      images.forEach((src,i)=>{
        const t = document.createElement('img');
        t.src = src; t.alt = "ØµÙˆØ±Ø© " + (i+1); t.loading="lazy";
        t.onerror = ()=>{ t.remove(); };
        if(i===0) t.classList.add('active');
        t.onclick = ()=>{ 
          [...thumbs.children].forEach(c=>c.classList.remove('active'));
          t.classList.add('active');
          mainImg.src = src;
          currentIndex = images.indexOf(src);
        };
        thumbs.appendChild(t);
      });
      card.appendChild(thumbs);
    }

    // Ø§Ù„Ù…Ø­ØªÙˆÙ‰
    const c = document.createElement('div'); c.className="content";
    c.innerHTML = `
      <div class="title">${escapeHTML(p.name || "Ù…Ù†ØªØ¬")}</div>
      <div class="price">${formatPrice(p.price)} Ø¯.Ù…</div>
      <div class="muted">${escapeHTML(p.description || "")}</div>
    `;
    card.appendChild(c);

    // Ø£Ø²Ø±Ø§Ø±
    const actions = document.createElement('div'); actions.className="actions";
    const addBtn = document.createElement('button'); addBtn.className="btn"; addBtn.textContent="Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©";
    addBtn.onclick = ()=>{ addToCart({id:p.objectId,name:p.name,price:Number(p.price)||0,image:images[0]||FALLBACK_SRC}); addBtn.textContent="ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ“"; setTimeout(()=>addBtn.textContent="Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©",1200); };
    actions.appendChild(addBtn);
    card.appendChild(actions);

    listEl.appendChild(card);
  });
}

/* ====== ØªØ­ÙˆÙŠÙ„ Ø­Ù‚ÙˆÙ„ Ø§Ù„ØµÙˆØ± (Ù…Ø±Ù†) ======
   ÙŠÙ‚Ø¨Ù„:
   - p.images: Ù…ØµÙÙˆÙØ© JSON ÙÙŠ Backendless (Ø­Ù‚Ù„ JSON Array)
   - p.imagesJson: Ù†Øµ JSON Ù„Ù…ØµÙÙˆÙØ© ØµÙˆØ±
   - p.imageUrls: Ù†Øµ Ù…ÙØµÙˆÙ„ Ø¨ÙÙˆØ§ØµÙ„
   - p.imageUrl: Ø±Ø§Ø¨Ø· ÙˆØ§Ø­Ø¯
*/
function normalizeImages(p){
  // 1) JSON Array Ù…Ø¨Ø§Ø´Ø±
  if (Array.isArray(p.images)) return p.images.filter(Boolean);

  // 2) Ø¥Ø°Ø§ Backendless Ø±Ø¬Ù‘Ø¹ Ù†Øµ JSON
  if (typeof p.images === "string") {
    try { const arr = JSON.parse(p.images); if (Array.isArray(arr)) return arr.filter(Boolean); } catch(e){}
  }
  if (typeof p.imagesJson === "string") {
    try { const arr = JSON.parse(p.imagesJson); if (Array.isArray(arr)) return arr.filter(Boolean); } catch(e){}
  }

  // 3) Ù†Øµ Ù…ÙØµÙˆÙ„ Ø¨ÙÙˆØ§ØµÙ„
  if (typeof p.imageUrls === "string") return p.imageUrls.split(",").map(s=>s.trim()).filter(Boolean);

  // 4) Ø±Ø§Ø¨Ø· ÙˆØ§Ø­Ø¯
  if (typeof p.imageUrl === "string") return [p.imageUrl];

  return [];
}

/* ====== Ø³Ø­Ø¨ ÙŠÙ…ÙŠÙ†/ÙŠØ³Ø§Ø± Ù„Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ====== */
function enableSwipe(imgEl, images){
  let startX=0, current=0;
  let idx = 0;
  imgEl.addEventListener('touchstart', (e)=>{ startX = e.touches[0].clientX; }, {passive:true});
  imgEl.addEventListener('touchend', (e)=>{
    const endX = e.changedTouches[0].clientX;
    const dx = endX - startX;
    if(Math.abs(dx) > 30 && images.length>1){
      // Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø³Ø­Ø¨
      if(dx < 0) idx = (idx + 1) % images.length;    // ÙŠØ³Ø§Ø± â†’ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
      else       idx = (idx - 1 + images.length) % images.length; // ÙŠÙ…ÙŠÙ† â†’ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
      imgEl.src = images[idx] || FALLBACK_SRC;
    }
  }, {passive:true});
}

/* ====== Ø³Ù„Ø© Ù…Ø­Ù„ÙŠØ© ====== */
const CART_KEY = "shoppingCart";
function readCart(){ try{ return JSON.parse(localStorage.getItem(CART_KEY))||[] }catch{ return [] } }
function writeCart(items){ localStorage.setItem(CART_KEY, JSON.stringify(items)) }
function addToCart(item){
  const cart=readCart();
  const idx = cart.findIndex(x=>x.id===item.id);
  if(idx>-1){ cart[idx].qty=(cart[idx].qty||1)+1; }
  else { cart.push({...item,qty:1}); }
  writeCart(cart);
  renderCart();
}

/* ====== ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø³Ù„Ø©/Ø§Ù„Ø¯ÙØ¹ ====== */
const drawer = document.getElementById('cart-drawer');
document.getElementById('open-cart').onclick = ()=>{ drawer.classList.add('open'); renderCart(); };
document.getElementById('close-cart').onclick = ()=>drawer.classList.remove('open');
document.getElementById('close-cart-2').onclick = ()=>drawer.classList.remove('open');
document.getElementById('clear-cart').onclick = ()=>{ writeCart([]); renderCart(); };

function renderCart(){
  const box = document.getElementById('cart-items'); box.innerHTML="";
  const cart = readCart();
  if(cart.length===0){ box.innerHTML = `<p class="muted">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©.</p>`; document.getElementById('cart-total').textContent="0"; return; }
  let total=0;
  cart.forEach((it,i)=>{
    total += (it.price||0) * (it.qty||1);
    const row = document.createElement('div'); row.className="row";
    row.innerHTML = `
      <div style="display:flex;gap:10px;align-items:center">
        <img src="${it.image||FALLBACK_SRC}" alt="" style="width:54px;height:54px;border-radius:10px;object-fit:cover">
        <div>
          <div><strong>${escapeHTML(it.name||"")}</strong></div>
          <div class="muted">${formatPrice(it.price)} Ø¯.Ù…</div>
        </div>
      </div>
      <div class="qty">
        <button aria-label="Ø¥Ù†Ù‚Ø§Øµ" data-i="${i}" data-op="-">âˆ’</button>
        <span>${it.qty||1}</span>
        <button aria-label="Ø²ÙŠØ§Ø¯Ø©" data-i="${i}" data-op="+">+</button>
        <button title="Ø­Ø°Ù" style="margin-inline-start:8px" data-i="${i}" data-op="x">ğŸ—‘ï¸</button>
      </div>
    `;
    box.appendChild(row);
  });
  document.getElementById('cart-total').textContent = formatPrice(total);
  // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ÙƒÙ…ÙŠØ©/Ø§Ù„Ø­Ø°Ù
  box.querySelectorAll('button').forEach(b=>{
    b.onclick = ()=>{
      const i = Number(b.dataset.i); const op=b.dataset.op; const cart=readCart();
      if(op==="+") cart[i].qty=(cart[i].qty||1)+1;
      if(op==="-" && cart[i].qty>1) cart[i].qty--;
      if(op==="x") cart.splice(i,1);
      writeCart(cart); renderCart();
    };
  });
}

/* ====== Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ====== */
document.getElementById('checkout-form').addEventListener('submit', (e)=>{
  e.preventDefault();
  const fd = new FormData(e.target);
  const name = (fd.get('name')||"").trim();
  const phone= (fd.get('phone')||"").trim().replace(/\D/g,'');
  const city = (fd.get('city')||"").trim();
  const cart = readCart();
  if(cart.length===0){ alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©."); return; }
  const lines = cart.map(x=>`â€¢ ${x.name} Ã— ${x.qty} = ${formatPrice((x.price||0)*x.qty)} Ø¯.Ù…`);
  const total = cart.reduce((s,x)=>s+(x.price||0)*(x.qty||1),0);
  const msg = `Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯:%0AØ§Ù„Ø§Ø³Ù…: ${encodeURIComponent(name)}%0AØ§Ù„Ù‡Ø§ØªÙ: ${encodeURIComponent(phone)}%0AØ§Ù„Ù…Ø¯ÙŠÙ†Ø©: ${encodeURIComponent(city)}%0A%0AØ§Ù„Ù…Ù†ØªØ¬Ø§Øª:%0A${encodeURIComponent(lines.join('%0A'))}%0A%0AØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${formatPrice(total)} Ø¯.Ù…`;
  const waUrl = `https://wa.me/${phone}?text=${msg}`;
  window.open(waUrl,'_blank');
});

/* ====== ØµÙˆØ±Ø© Ù…ÙƒØ¨Ø±Ø© ====== */
const imgModal = document.getElementById('img-modal');
const modalImg = document.getElementById('modal-img');
function openImage(src){ modalImg.src=src; imgModal.classList.add('open'); }
imgModal.onclick = ()=> imgModal.classList.remove('open');

/* ====== Ø£Ø¯ÙˆØ§Øª ====== */
function formatPrice(v){ return Number(v||0).toLocaleString('ar-MA',{maximumFractionDigits:2}); }
function escapeHTML(s){ return String(s).replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

/* ====== Ø¥Ø·Ù„Ø§Ù‚ ====== */
loadProducts();
// Ø²Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø¹Ø§Ø¦Ù… ÙŠÙØªØ­ Ø§Ù„Ø³Ù„Ø© ÙƒØ§Ø®ØªØµØ§Ø±
document.getElementById('wa-float').onclick = (e)=>{ e.preventDefault(); document.getElementById('open-cart').click(); };
</script>
</body>
</html>